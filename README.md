# 光遇自动送火 (SkyAutoLightGift)

光遇自动送火（SkyAutoLightGift）是一个开源项目，用于在游戏《光遇》中自动为星盘上的每位好友送上心火。本应用通过无障碍服务获得星盘上每位好友的名字（TextView）的位置，并使用ESP32为手机模拟手柄操作以自动完成送火。

本应用在网易国服 0.12.7版本测试通过。

For English, please refer to the [English README](README_EN.md).

## 功能介绍

- 自动识别星盘上的好友名字
- 通过模拟点击操作进入好友菜单
- 自动送火（需要ESP32辅助）

## 原理说明

1. **识别好友名字的位置**：由于光遇星盘的好友位置是随机的，程序会先利用无障碍服务获取星盘上每位好友的名字（TextView）的位置。
2. **进入好友菜单**：
    - 超快速点击textview的中间和左右边缘，趁游戏没反应过来进入菜单
    - 检查屏幕上是否只包含好友名字（排除送火成功提示中的“心火”二字），如果是则已进入菜单
4. **发送光之礼物**：使用ESP32为手机模拟按下手柄按键X送火，之后按下B键返回星盘

## 免责声明

本应用通过模拟操作的方式实现自动送火，不会修改游戏内存，但使用第三方辅助工具皆有遭到封禁的可能。开发者不对使用此应用导致的任何损失负责。

## 使用方法

1. 克隆本仓库到本地：
    ```bash
    git clone https://github.com/milkycandy/SkyAutoLightGift.git
    ```
2. 使用Arduino IDE导入`SkyAutoLighting.ino`，编译并上传至ESP32。
3. 将手机和ESP32连接到同一WiFi，ESP32会使用串口打印自己的本地IP地址，波特率为115200。
4. 修改`FloatingWindowService`中硬编码的ESP32 IP地址为实际局域网地址。
5. 导入项目到Android Studio中，连接你的手机，构建并运行应用。
6. 点击启动键，应用会引导你开启无障碍服务和悬浮窗权限。
7. 悬浮窗出现后，打开光遇的星盘，翻到你希望送火的那一页，点击开始按钮。

## 需要改进的地方

1. **自动翻页**：计划实现送完一页好友后自动翻页并为下一页好友送上心火。
2. **中断送火**：计划增加自动送火时的取消按钮。
3. **进入好友菜单的方法**：目前点击星盘上的好友进入菜单的方法跟优雅不沾边，需要想一个更合适的方法。

## 已知问题

- 如果星盘分组名不为“好友”或“挚友”，程序会把星盘名也当作好友点击。
- 如果好友备注中包含“心火”，则该好友会被程序忽略。
- 网易MuMu模拟器无法使用（无法获取屏幕布局）。
- 还有很多。。。

## 贡献

如果你有任何疑问或建议，请提交Issue或联系 [ohayo@milkycandy.cn](mailto:ohayo@milkycandy.cn)。

## 许可证

该项目基于 GPL-3.0 许可证开源。详情请参见 [LICENSE](LICENSE) 文件。
